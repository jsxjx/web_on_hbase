{% extends "base.html" %}
{% block maincontents %}
<div class="content-section">
    <div class="container">
        <form action="/ajax_single_para/"  role="form">

            <div class=“form-group”>
                <div class="form-inline">
                    <label>构型选择</label><br>
                    <select name="configuration" id="id_stencil_conf" class="form-control">
                        <option value="512">512</option>
                        <option value="256">256</option>
                    </select>
                </div>
                <div class="form-inline">
                    <label>序号（只能输入数字）</label><br>
                    <input type="text" name="ATA" class="form-control" id="id_stencil_ATA" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')"/>
                </div>
                <div class="form-inline">
                    <label>模版名称</label><br>
                    <input type="text" name="stencil_name" id="id_stencil_name" class="form-control" />
                </div>
                <div>
                    <label>参数列表（输入参数ID号，只能输入数字和英文逗号，两个参数间以英文逗号分割，最后一个参数不加逗号）
                    <br>示例：1,2,3,4,5,6</label>
                    <input type="text" name="list_para" class="form-control" id="id_stencil_para" onkeyup="this.value=this.value.replace(/[^\d|,]/g,'')" onafterpaste="this.value=this.value.replace(/[^\d|,]/g,'')"/>
                </div>
            </div>
            <input type="submit" value="录入" id="set" class="btn btn-default" />
        </form>
    </div>

    <div class="container">
        <h2>所有航段：</h2>
        <table id="table" data-sort-name="stargazers_count" data-sort-order="desc" data-pagination="true" data-page-size="15" data-page-list="[15,30,66,100]" data-show-pagination-switch="true">

        </table>
    </div>
    <!-- /container -->
</div>
<!--/.content-section -->
<script>


var $table = $('#table');
var empty_json = {}
$(function() {

    columns_set = [
            {
                title: 'index',
                field: 'index',
                align: 'center',
                valign: 'middle',
                sortable: true
            },
            {
                title: 'value',
                field: 'value',
                align: 'center',
                valign: 'middle',
                sortable: true
            }
        ]


    $.ajax({
        type: "GET",
        contentType: "application/json;charset=utf-8",
        url: '/single_para_query/',
        dataType: "json",
        beforeSend: function () {
            $table.bootstrapTable({
                data: empty_json,
                columns: columns_set,
                search: true
            });
            $table.bootstrapTable('showLoading');
        },


        success: function(result, statues, xml){
            $table.bootstrapTable('hideLoading');
            $table.bootstrapTable('load', result);

            }
        });

});


$(document).ready(function(){
      $("#set").click(function(){
        var stencil_conf = document.querySelector('#id_stencil_conf').value;
        var stencil_name = $("#id_stencil_name").val();
        var stencil_ATA = $("#id_stencil_ATA").val();
 		var stencil_para = $("#id_stencil_para").val();
        if (stencil_name==''||stencil_ATA==''||stencil_para==''){
            alert("信息不完整，请输入所有信息");
            return false;
        }



        $.ajax({
                    type:"GET",
                    data: {stencil_conf:stencil_conf,stencil_name:stencil_name,stencil_para:stencil_para,stencil_ATA:stencil_ATA},
                    url: "{% url 'ajax_single_para' %}", //后台处理函数的url 这里用的是static url 需要与urls.py中的name一致
                    cache: false,
                    dataType: "html",
                    beforeSend: function () {
                        //$table.bootstrapTable('showLoading');
                        $table.bootstrapTable('load', empty_json);
                    },
                    success: function(result, statues, xml){
                        $table.bootstrapTable('hideLoading');
                        $table.bootstrapTable('load', result);                                        //成功时弹出view传回来的结果
                    },
                    error: function(){
                        alert("录入不成功");
                    }
                });
                return false;
      });
    });

</script>

{% endblock %}