{% extends "base.html" %}
{% block maincontents %}
<div class="content-section">
    <div class="container">
        <h2>请选择参数模版：</h2>
        <form action="/ajax_some_para/"  role="form">
            <div class=“form-group”>
                <div class="form-inline">
                    <label>模版选择</label><br>
                    <select name="configuration" id="id_conf" class="form-control">
                        {% for option_dict in stencil_option %}
                            <option value= {{ option_dict.index}}>{{ option_dict.NAME }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <input type="submit" value="查询" id="set" class="btn btn-default" />
        </form>
        <table id="table" data-sort-name="stargazers_count" data-sort-order="desc" data-pagination="true" data-page-size="15" data-page-list="[15,30,66,100]" data-show-pagination-switch="true">

        </table>
    </div>
    <!-- /container -->
</div>
<!--/.content-section -->
<script>
var list_flight_id = {{ json_list | safe}};
var flight_id = list_flight_id[0];
var $table = $('#table');
var empty_json = {}
$(function() {

    columns_set = [
            {
                title: 'index',
                field: 'index',
                align: 'center',
                valign: 'middle',
                sortable: true
            },
            {
                title: 'value',
                field: 'value',
                align: 'center',
                valign: 'middle',
                sortable: true
            }
        ]
    $table.bootstrapTable({
                data: empty_json,
                columns: columns_set,
                search: true
            });

});


$(document).ready(function(){
      $("#set").click(function(){
        var column_index = $("#id_colunm_index").val();
        var value_conf = document.querySelector('#id_conf').value
        if (column_index==''){
            alert("信息不完整，请输入所有信息");
            return false;
        }



        $.ajax({
                    type:"GET",
                    data: {
                        value_conf:value_conf, 
                        flight_id:flight_id,
                    },
                    url: "{% url 'ajax_some_para' %}", //后台处理函数的url 这里用的是static url 需要与urls.py中的name一致
                    cache: false,
                    dataType: "json",
                    beforeSend: function () {
                        $table.bootstrapTable('showLoading');
                        $table.bootstrapTable('load', empty_json);
                    },
                    success: function(result, statues, xml){
                        $table.bootstrapTable('hideLoading');
                        para_name_list = result[0];
                        $table.bootstrapTable('destroy');
                        var columns_set_one = {};
                        var columns_set_array = [];
                        //将index放在首列
                        columns_set_one={
                                title: 'index',
                                field: 'index',
                                align: 'center',
                                valign: 'middle',
                                sortable: true
                            }
                        columns_set_array.push(columns_set_one);
                        //将GMT_TIME放入第二列
                        columns_set_two = {
                            title: '$GMT TIME',
                            field: '$GMT TIME',
                            align: 'center',
                            valign: 'middle',
                            sortable: true
                        }
                        columns_set_array.push(columns_set_two);
                        for(var item in para_name_list){
                            if(item != 'index' && item != '$GMT TIME'){
                                columns_set_one={
                                    title: item,
                                    field: item,
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: true
                                }
                                columns_set_array.push(columns_set_one);
                            }
                        }
                        
                        result.shift();
                        $table.bootstrapTable({
                            data: result,
                            columns: columns_set_array,
                            search: true
                        });
                        //成功时弹出view传回来的结果
                    },
                    error: function(){
                        alert("查询失败");
                    }
                });
                return false;
      });
    });

</script>

{% endblock %}